<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <title>OpenTrading - Professional Platform</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>

    <style>
        /* --- Core Styles & Liquid Glass Effect --- */
        @keyframes moveGradient {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            
            /* --- Liquid Glass Animated Background --- */
            background-color: #000;
            background-image: linear-gradient(
                120deg,
                rgba(0, 122, 255, 0.2) 0%,
                rgba(191, 90, 242, 0.15) 40%,
                rgba(0, 50, 80, 0.3) 100%
            );
            background-size: 400% 400%;
            animation: moveGradient 20s ease-in-out infinite alternate;
        }

        /* Define color variables */
        :root {
            --bg-tertiary: rgba(60, 60, 67, 0.5); 
            --text-primary: #ffffff;
            --text-secondary: #a1a1aa; 
            --border-color: rgba(90, 90, 90, 0.5);
            --accent-color: #0a84ff;
            --buy-color: #26a69a;
            --sell-color: #ef5350;
        }

        .bg-tertiary { background-color: var(--bg-tertiary); }
        .text-primary { color: var(--text-primary); }
        .text-secondary { color: var(--text-secondary); }
        .border-custom { border-color: var(--border-color); }
        .accent-text { color: var(--accent-color); }
        .accent-bg { background-color: var(--accent-color); }
        .buy-text { color: var(--buy-color); }
        .sell-text { color: var(--sell-color); }
        .buy-bg { background-color: var(--buy-color); }
        .sell-bg { background-color: var(--sell-color); }

        /* Primary Glass Panel Style (for individual components) */
        .glass-panel {
            background: rgba(28, 28, 30, 0.7);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1.25rem; /* 20px */
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }
        
        /* Main Container Glass Style (wraps all content) */
        .main-glass-container {
            background: rgba(18, 18, 18, 0.5);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        
        .nav-glass {
            background: rgba(18, 18, 18, 0.75);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }

        /* --- LOADING SCREEN STYLES --- */
        #loading-screen {
            transition: opacity 0.5s ease-in-out;
        }
        #loading-screen.fade-out {
            opacity: 0;
            pointer-events: none;
        }
        #progress-bar {
            background: linear-gradient(90deg, var(--accent-color) 0%, #bf5af2 100%);
            box-shadow: 0 0 10px var(--accent-color), 0 0 20px #bf5af2;
            transition: width 0.1s linear;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(90, 90, 90, 0.7); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(120, 120, 120, 0.8); }

        input[type='number']::-webkit-inner-spin-button,
        input[type='number']::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type='number'] { -moz-appearance: textfield; }
        
        * { transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out, border-color 0.2s ease-in-out; }
        .charts-tab-content { display: none; }
        .charts-tab-content.active { display: block; }
        .status-connecting { background-color: #f39c12; color: #1e222d; }
        .status-connected { background-color: var(--buy-color); color: white; }
        .status-disconnected { background-color: var(--sell-color); color: white; }
    </style>
</head>
<body class="text-primary antialiased">
    
    <!-- Loading Screen -->
    <div id="loading-screen" class="fixed inset-0 z-50 flex flex-col items-center justify-center p-4" style="background: inherit; backdrop-filter: blur(10px);">
        <div class="text-center">
            <h1 class="text-4xl md:text-5xl font-bold text-primary mb-4">
                <i class="fas fa-chart-line accent-text"></i> OpenTrading
            </h1>
            <p class="text-secondary mb-8">Initializing Trading Environment...</p>
        </div>
        <div class="w-full max-w-sm">
            <div id="progress-bar-container" class="w-full p-1 rounded-full" style="background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.1);">
                <div id="progress-bar" class="h-3 rounded-full" style="width: 0%;"></div>
            </div>
            <p id="progress-text" class="text-center text-secondary mt-2 text-sm">0%</p>
        </div>
    </div>

    <!-- Main Application (Initially Hidden) -->
    <div id="main-app-container" class="hidden h-screen w-screen flex flex-col md:flex-row">
        <!-- Desktop Navigation -->
        <nav id="desktop-nav" class="hidden md:flex flex-col w-64 nav-glass border-r border-custom p-4 space-y-2">
            <div class="px-4 py-2 mb-4">
                <h1 class="text-2xl font-bold text-primary"><i class="fas fa-chart-line accent-text"></i> OpenTrading</h1>
            </div>
            <a href="#" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg text-secondary hover:bg-tertiary" data-section="charts">
                <i class="fas fa-chart-pie w-6 text-center"></i><span data-i18n-key="nav_charts">Charts</span>
            </a>
            <a href="#" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg text-primary hover:bg-tertiary" data-section="news">
                <i class="fas fa-newspaper w-6 text-center"></i><span data-i18n-key="nav_news">News</span>
            </a>
            <a href="#" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg text-secondary hover:bg-tertiary" data-section="education">
                <i class="fas fa-book w-6 text-center"></i><span data-i18n-key="nav_education">Education</span>
            </a>
            <a href="#" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg text-secondary hover:bg-tertiary" data-section="api">
                <i class="fas fa-code w-6 text-center"></i><span data-i18n-key="nav_api">API</span>
            </a>
            <div class="flex-grow"></div>
            <div class="space-y-4 p-4">
                 <div class="relative">
                    <button id="lang-switcher" class="w-full flex justify-between items-center text-left bg-tertiary px-4 py-2 rounded-lg">
                        <span class="flex items-center"><i class="fas fa-globe mr-2"></i><span id="current-lang-text">English</span></span>
                        <i class="fas fa-chevron-down text-xs"></i>
                    </button>
                    <div id="lang-dropdown" class="hidden absolute bottom-full mb-2 w-full nav-glass border border-custom rounded-lg shadow-lg z-20">
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col overflow-hidden">
            <header class="md:hidden flex items-center justify-between p-4 nav-glass border-b border-custom">
                <h1 class="text-xl font-bold text-primary"><i class="fas fa-chart-line accent-text"></i> OpenTrading</h1>
            </header>

            <div class="flex-1 overflow-y-auto p-2 md:m-6 md:rounded-tl-2xl main-glass-container md:p-6 lg:p-8">
                <section id="charts-section" class="app-section hidden">
                    <!-- Mobile Optimized Layout -->
                    <div class="flex flex-col lg:grid lg:grid-cols-3 xl:grid-cols-4 gap-6">
                        <!-- Column 1: Controls (stacks on mobile) -->
                        <div class="lg:col-span-1 xl:col-span-1 flex flex-col space-y-6">
                            <div class="glass-panel p-4">
                                <h3 class="text-lg font-semibold text-primary mb-3" data-i18n-key="paper_balance_title">Available Balance</h3>
                                <div id="balance-display" class="text-3xl font-bold text-primary text-center py-2">10000.00 USDT</div>
                            </div>
                            
                            <div class="glass-panel p-4">
                                <h3 id="price-panel-title" class="text-lg font-semibold text-primary mb-2 text-center">BTCUSDT Price</h3>
                                <div id="price-display" class="text-3xl font-bold text-primary text-center py-1">...</div>
                                <div id="connection-status" class="text-xs font-medium p-1 rounded text-center mt-2 status-disconnected">Disconnected</div>
                            </div>

                            <div class="glass-panel p-4">
                                <h3 class="text-lg font-semibold text-primary mb-4" data-i18n-key="paper_trade_panel_title">Trade Panel</h3>
                                <div class="space-y-4">
                                    <div>
                                        <label for="symbol-input" class="block text-sm font-medium text-secondary" data-i18n-key="paper_symbol">Trading Symbol</label>
                                        <input type="text" id="symbol-input" value="BTCUSDT" class="mt-1 w-full bg-tertiary border-transparent rounded-lg px-3 py-2 text-primary focus:outline-none focus:ring-2 accent-border">
                                    </div>
                                    <div>
                                        <label for="leverage" class="block text-sm font-medium text-secondary" data-i18n-key="paper_leverage">Leverage</label>
                                        <select id="leverage" class="mt-1 w-full bg-tertiary border-transparent rounded-lg px-3 py-2 text-primary focus:outline-none focus:ring-2 accent-border">
                                            <option value="1">1x</option><option value="5">5x</option><option value="10" selected>10x</option><option value="20">20x</option><option value="50">50x</option><option value="100">100x</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="amount" class="block text-sm font-medium text-secondary" data-i18n-key="paper_amount">Amount (USDT)</label>
                                        <input type="number" id="amount" value="1000" class="mt-1 w-full bg-tertiary border-transparent rounded-lg px-3 py-2 text-primary focus:outline-none focus:ring-2 accent-border">
                                    </div>
                                    <div class="flex space-x-3 pt-2">
                                        <button id="buy-button" class="w-full buy-bg text-white font-bold py-3 px-4 rounded-lg hover:opacity-90 transition-opacity"><span data-i18n-key="paper_buy_long">BUY</span></button>
                                        <button id="sell-button" class="w-full sell-bg text-white font-bold py-3 px-4 rounded-lg hover:opacity-90 transition-opacity"><span data-i18n-key="paper_sell_short">SELL</span></button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Column 2: Chart -->
                        <div class="lg:col-span-2 xl:col-span-3 flex flex-col">
                            <div class="flex items-center border-b border-custom mb-4">
                                <button class="chart-tab-btn px-4 py-2 text-sm md:text-base font-semibold border-b-2 border-transparent" data-tab="chart"><span data-i18n-key="tab_chart">Chart</span></button>
                                <button class="chart-tab-btn px-4 py-2 text-sm md:text-base font-semibold border-b-2 border-transparent" data-tab="leaderboard"><span data-i18n-key="tab_leaderboard">Leaderboard</span></button>
                            </div>

                            <div class="flex-grow">
                                <div id="chart-tab-content" class="charts-tab-content active h-[60vh] lg:h-auto lg:aspect-[16/10] glass-panel">
                                    <div id="tradingview-widget-container" class="w-full h-full rounded-[1.25rem] overflow-hidden"></div>
                                </div>
                                <div id="leaderboard-tab-content" class="charts-tab-content glass-panel p-4 md:p-6">
                                    <h3 class="text-xl font-bold text-primary mb-4" data-i18n-key="leaderboard_title">Leaderboard (Demo)</h3>
                                    <div class="overflow-x-auto">
                                        <table class="w-full text-sm text-left text-secondary">
                                            <thead class="text-xs text-primary uppercase bg-tertiary">
                                                <tr>
                                                    <th scope="col" class="px-4 py-3" data-i18n-key="leaderboard_rank">Rank</th><th scope="col" class="px-4 py-3" data-i18n-key="leaderboard_user">User</th><th scope="col" class="px-4 py-3 text-right" data-i18n-key="leaderboard_profit">Profit %</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr class="border-b border-custom"><td class="px-4 py-3 font-medium text-primary">1. 🥇</td><td class="px-4 py-3 font-medium text-primary">CryptoKing</td><td class="px-4 py-3 text-right font-bold buy-text">+1245.5%</td></tr>
                                                <tr class="border-b border-custom"><td class="px-4 py-3 font-medium text-primary">2. 🥈</td><td class="px-4 py-3 font-medium text-primary">ScalperPro</td><td class="px-4 py-3 text-right font-bold buy-text">+987.2%</td></tr>
                                                <tr class="border-b border-custom"><td class="px-4 py-3 font-medium text-primary">3. 🥉</td><td class="px-4 py-3 font-medium text-primary">DiamondHands</td><td class="px-4 py-3 text-right font-bold buy-text">+602.8%</td></tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Full-width Row: Tables -->
                         <div class="lg:col-span-3 xl:col-span-4 flex flex-col space-y-6 mt-6">
                            <div class="glass-panel p-4 overflow-x-auto">
                                <h3 class="text-lg font-semibold text-primary mb-4" data-i18n-key="paper_open_positions">Open Positions</h3>
                                <table class="w-full text-sm text-left text-secondary whitespace-nowrap">
                                    <thead class="text-xs text-primary uppercase bg-tertiary">
                                        <tr>
                                            <th scope="col" class="px-4 py-3" data-i18n-key="tbl_symbol">Symbol</th><th scope="col" class="px-4 py-3" data-i18n-key="tbl_type">Type</th><th scope="col" class="px-4 py-3" data-i18n-key="tbl_margin">Margin</th><th scope="col" class="px-4 py-3" data-i18n-key="tbl_entry">Entry</th><th scope="col" class="px-4 py-3" data-i18n-key="tbl_liq">Liq. Price</th><th scope="col" class="px-4 py-3" data-i18n-key="tbl_pnl">P/L (USDT)</th><th scope="col" class="px-4 py-3" data-i18n-key="tbl_action">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="open-positions-table"></tbody>
                                </table>
                            </div>

                            <div class="glass-panel p-4 overflow-x-auto">
                                <h3 class="text-lg font-semibold text-primary mb-4" data-i18n-key="paper_trade_history">Trade History</h3>
                                <table class="w-full text-sm text-left text-secondary whitespace-nowrap">
                                    <thead class="text-xs text-primary uppercase bg-tertiary">
                                        <tr>
                                            <th scope="col" class="px-4 py-3" data-i18n-key="tbl_symbol">Symbol</th><th scope="col" class="px-4 py-3" data-i18n-key="tbl_type">Type</th><th scope="col" class="px-4 py-3" data-i18n-key="tbl_exit">Exit Price</th><th scope="col" class="px-4 py-3" data-i18n-key="tbl_pnl">P/L (USDT)</th><th scope="col" class="px-4 py-3" data-i18n-key="tbl_reason">Reason</th>
                                        </tr>
                                    </thead>
                                    <tbody id="closed-orders-table"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="news-section" class="app-section">
                    <h2 class="text-3xl font-bold text-primary mb-6 px-2" data-i18n-key="section_title_news">Market News</h2>
                    <div id="tradingview-news-widget-container" class="h-[75vh] glass-panel rounded-[1.25rem] overflow-hidden p-1"></div>
                </section>

                <section id="education-section" class="app-section hidden">
                    <h2 class="text-3xl font-bold text-primary mb-6 px-2" data-i18n-key="section_title_education">Education</h2>
                    <div class="glass-panel p-8 md:p-12 text-center">
                        <i class="fas fa-graduation-cap text-5xl text-secondary mb-6"></i>
                        <h3 class="text-2xl font-bold text-primary mb-4" data-i18n-key="education_title">The Trader's Codex</h3>
                        <p class="text-lg text-secondary max-w-2xl mx-auto mb-8" data-i18n-key="education_desc">
                            This is not a standard trading course. The Codex is a collection of principles, mental models, and risk management strategies designed to build a resilient and disciplined trading mindset.
                        </p>
                        <a href="kodeks.pdf" download="The_Traders_Codex.pdf" class="inline-block accent-bg text-white font-bold py-3 px-8 rounded-lg hover:opacity-90 transition-opacity text-lg">
                            <i class="fas fa-download mr-2"></i>
                            <span data-i18n-key="education_download_button">Download The Codex</span>
                        </a>
                    </div>
                </section>
                
                <section id="api-section" class="app-section hidden">
                    <h2 class="text-3xl font-bold text-primary mb-6 px-2" data-i18n-key="section_title_api">API Access & Integration</h2>
                     <div class="glass-panel p-6 md:p-12 text-center flex flex-col lg:flex-row items-center gap-8">
                        <div class="flex-shrink-0 w-full max-w-[410px]">
                           <iframe src="https://nowpayments.io/embeds/payment-widget?iid=5567721310" width="100%" height="696" frameborder="0" scrolling="no" style="overflow-y: hidden; border-radius: 1rem;">
                               Can't load widget
                           </iframe>
                        </div>
                        <div class="text-center lg:text-left">
                             <i class="fas fa-cogs text-5xl accent-text mb-6"></i>
                             <h3 class="text-2xl font-bold text-primary mb-4" data-i18n-key="api_title">Connect to our Automated System</h3>
                             <p class="text-lg text-secondary mb-4" data-i18n-key="api_desc">
                                 Gain access to our exclusive Telegram bot for signals and automated trading strategies. Use the widget to complete your one-time access payment.
                             </p>
                             <p class="text-md text-primary font-semibold bg-tertiary p-4 rounded-lg">
                                <i class="fab fa-telegram-plane mr-2"></i>
                                <span data-i18n-key="api_process">After successful payment, we will contact you within 48 hours to connect you with the Telegram bot.</span>
                             </p>
                        </div>
                    </div>
                </section>
            </div>
            
            <!-- Mobile Navigation -->
            <nav id="mobile-nav" class="md:hidden grid grid-cols-4 gap-1 p-2 nav-glass border-t border-custom">
                <a href="#" class="nav-item flex flex-col items-center justify-center p-2 rounded-lg text-secondary" data-section="charts">
                    <i class="fas fa-chart-pie text-xl"></i><span class="text-xs mt-1" data-i18n-key="nav_charts">Charts</span>
                </a>
                <a href="#" class="nav-item flex flex-col items-center justify-center p-2 rounded-lg text-primary" data-section="news">
                    <i class="fas fa-newspaper text-xl"></i><span class="text-xs mt-1" data-i18n-key="nav_news">News</span>
                </a>
                <a href="#" class="nav-item flex flex-col items-center justify-center p-2 rounded-lg text-secondary" data-section="education">
                    <i class="fas fa-book text-xl"></i><span class="text-xs mt-1" data-i18n-key="nav_education">Education</span>
                </a>
                <a href="#" class="nav-item flex flex-col items-center justify-center p-2 rounded-lg text-secondary" data-section="api">
                    <i class="fas fa-code text-xl"></i><span class="text-xs mt-1" data-i18n-key="nav_api">API</span>
                </a>
            </nav>
        </main>
    </div>


    <script>
        // --- App State & DOM Elements ---
        const state = {
            currentLang: 'en',
            currentSection: 'news',
            paperTrade: {
                accountBalance: 10000, openPositions: [], closedOrders: [],
                currentPrice: 0, currentSymbol: "BTCUSDT", priceSocket: null
            }
        };

        const dom = {
            loadingScreen: document.getElementById('loading-screen'),
            progressBar: document.getElementById('progress-bar'),
            progressText: document.getElementById('progress-text'),
            mainAppContainer: document.getElementById('main-app-container'),
            navItems: document.querySelectorAll('.nav-item'),
            appSections: document.querySelectorAll('.app-section'),
            chartTabBtns: document.querySelectorAll('.chart-tab-btn'),
            chartsTabContents: document.querySelectorAll('.charts-tab-content'),
            langSwitcher: document.getElementById('lang-switcher'),
            langDropdown: document.getElementById('lang-dropdown'),
            currentLangText: document.getElementById('current-lang-text'),
            paper: {
                balanceDisplay: document.getElementById('balance-display'),
                pricePanelTitle: document.getElementById('price-panel-title'),
                priceDisplay: document.getElementById('price-display'),
                connectionStatus: document.getElementById('connection-status'),
                symbolInput: document.getElementById('symbol-input'),
                leverageSelect: document.getElementById('leverage'),
                amountInput: document.getElementById('amount'),
                buyButton: document.getElementById('buy-button'),
                sellButton: document.getElementById('sell-button'),
                openPositionsTable: document.getElementById('open-positions-table'),
                closedOrdersTable: document.getElementById('closed-orders-table'),
            }
        };

        // --- Internationalization (i18n) ---
        const i18nData = {
            en: {
                nav_charts: "Charts", nav_news: "News", nav_education: "Education", nav_api: "API",
                section_title_news: "Market News", section_title_education: "Education", section_title_api: "API Access & Integration",
                paper_balance_title: "Available Balance", paper_trade_panel_title: "Trade Panel", paper_symbol: "Trading Symbol", paper_leverage: "Leverage",
                paper_amount: "Amount (USDT)", paper_buy_long: "BUY", paper_sell_short: "SELL", paper_open_positions: "Open Positions", paper_trade_history: "Trade History",
                tbl_symbol: "Symbol", tbl_type: "Type", tbl_margin: "Margin", tbl_entry: "Entry",
                tbl_liq: "Liq. Price", tbl_pnl: "P/L (USDT)", tbl_action: "Action", tbl_action_close: "Close",
                tbl_exit: "Exit Price", tbl_reason: "Reason", tab_chart: "Chart", tab_leaderboard: "Leaderboard",
                leaderboard_title: "Leaderboard (Demo)", leaderboard_rank: "Rank", leaderboard_user: "User", leaderboard_profit: "Profit %",
                paper_alert_invalid_amount: "Please enter a valid amount (margin).", paper_alert_insufficient_balance: "Insufficient balance.",
                paper_alert_no_price: "Waiting for price before opening a position.",
                education_title: "The Trader's Codex", education_desc: "This is not a standard trading course. The Codex is a collection of principles, mental models, and risk management strategies designed to build a resilient and disciplined trading mindset.",
                education_download_button: "Download The Codex", api_title: "Connect to our Automated System", api_desc: "Gain access to our exclusive Telegram bot for signals and automated trading strategies. Use the widget to complete your one-time access payment.",
                api_process: "After successful payment, we will contact you within 48 hours to connect you with the Telegram bot.",
            },
            bg: {
                nav_charts: "Графики", nav_news: "Новини", nav_education: "Обучение", nav_api: "API",
                section_title_news: "Пазарни новини", section_title_education: "Обучение", section_title_api: "API Достъп",
                paper_balance_title: "Наличен Баланс", paper_trade_panel_title: "Панел за търговия", paper_symbol: "Символ", paper_leverage: "Ливъридж",
                paper_amount: "Количество (USDT)", paper_buy_long: "КУПИ", paper_sell_short: "ПРОДАЙ", paper_open_positions: "Отворени Позиции", paper_trade_history: "История",
                tbl_symbol: "Символ", tbl_type: "Тип", tbl_margin: "Маржин", tbl_entry: "Вход",
                tbl_liq: "Цена Ликв.", tbl_pnl: "P/L (USDT)", tbl_action: "Действие", tbl_action_close: "Затвори",
                tbl_exit: "Изходна Цена", tbl_reason: "Причина", tab_chart: "Графика", tab_leaderboard: "Класация",
                leaderboard_title: "Класация (Демо)", leaderboard_rank: "Място", leaderboard_user: "Потребител", leaderboard_profit: "% Печалба",
                paper_alert_invalid_amount: "Моля, въведете валидно количество (маржин).", paper_alert_insufficient_balance: "Недостатъчен баланс.",
                paper_alert_no_price: "Изчакайте цена преди да отворите позиция.",
                education_title: "Кодексът на Трейдъра", education_desc: "Това не е стандартен курс по търговия. Кодексът е колекция от принципи, мисловни модели и стратегии за управление на риска, създадени да изградят устойчив и дисциплиниран търговски манталитет.",
                education_download_button: "Изтегли Кодекса", api_title: "Свържете се с Автоматизирана Система", api_desc: "Получете достъп до нашия ексклузивен Telegram бот за сигнали и автоматизирани стратегии. Използвайте уиджета, за да платите.",
                api_process: "След успешно плащане, ще се свържем с вас до 48 часа, за да ви свържем с Telegram бота.",
            }
        };

        const availableLanguages = { en: 'English', bg: 'Български' };
        const getTranslatedText = (key) => i18nData[state.currentLang]?.[key] || i18nData.en[key] || key;

        function updateLanguage() {
            const lang = state.currentLang;
            document.documentElement.lang = lang;
            dom.currentLangText.textContent = availableLanguages[lang];
            document.querySelectorAll('[data-i18n-key]').forEach(el => { el.innerHTML = getTranslatedText(el.dataset.i18nKey); });
            document.querySelectorAll('[data-i18n-key-placeholder]').forEach(el => { el.placeholder = getTranslatedText(el.dataset.i18nKeyPlaceholder); });
            createTradingViewWidget(state.paperTrade.currentSymbol, lang);
            createNewsWidget(lang);
            updatePaperTradeUI(); 
        };
        
        const populateLanguageDropdown = () => {
            dom.langDropdown.innerHTML = '';
            for (const [code, name] of Object.entries(availableLanguages)) {
                const item = document.createElement('a');
                item.href = '#';
                item.className = 'block px-4 py-2 text-sm text-primary hover:bg-tertiary';
                item.textContent = name;
                item.onclick = (e) => {
                    e.preventDefault(); state.currentLang = code; localStorage.setItem('language', code);
                    updateLanguage(); dom.langDropdown.classList.add('hidden');
                };
                dom.langDropdown.appendChild(item);
            }
        };

        const switchSection = (sectionId) => {
            state.currentSection = sectionId;
            dom.appSections.forEach(section => section.classList.toggle('hidden', section.id !== `${sectionId}-section`));
            dom.navItems.forEach(item => {
                const isActive = item.dataset.section === sectionId;
                item.classList.toggle('text-primary', isActive); item.classList.toggle('bg-tertiary', isActive);
                item.classList.toggle('text-secondary', !isActive);
                if (!isActive) item.classList.remove('bg-tertiary');
            });
        };
        
        const createTradingViewWidget = (symbol, lang) => {
            const container = document.getElementById('tradingview-widget-container');
            if(!container) return; container.innerHTML = '';
            new TradingView.widget({
                "autosize": true, "symbol": `BINANCE:${symbol.toUpperCase()}`, "interval": "60",
                "timezone": "Etc/UTC", "theme": "dark", "style": "1", "locale": lang, 
                "toolbar_bg": "rgba(22, 22, 24, 0.0)", "enable_publishing": false, 
                "hide_side_toolbar": false, "allow_symbol_change": true,
                "withdateranges": true, "container_id": "tradingview-widget-container"
            });
        };

        const createNewsWidget = (lang) => {
            const container = document.getElementById('tradingview-news-widget-container');
            if (!container) return; container.innerHTML = ''; 
            const script = document.createElement('script');
            script.type = 'text/javascript';
            script.src = 'https://s3.tradingview.com/external-embedding/embed-widget-timeline.js';
            script.async = true;
            script.innerHTML = JSON.stringify({
                "feedMode": "all_symbols", "isTransparent": true, "displayMode": "regular",
                "width": "100%", "height": "100%", "colorTheme": "dark", "locale": lang
            });
            container.appendChild(script);
        };
        
        function setupForSymbol(symbol) {
            state.paperTrade.currentSymbol = symbol.toUpperCase();
            dom.paper.symbolInput.value = state.paperTrade.currentSymbol;
            createTradingViewWidget(state.paperTrade.currentSymbol, state.currentLang);
            connectWebSocket(state.paperTrade.currentSymbol);
        }

        function connectWebSocket(symbol) {
            if (state.paperTrade.priceSocket) state.paperTrade.priceSocket.close();
            const wsSymbol = symbol.toLowerCase();
            const statusDiv = dom.paper.connectionStatus;
            state.paperTrade.priceSocket = new WebSocket(`wss://stream.binance.com:9443/ws/${wsSymbol}@trade`);
            statusDiv.textContent = 'Connecting...'; statusDiv.className = 'text-xs font-medium p-1 rounded text-center mt-2 status-connecting';
            state.paperTrade.priceSocket.onopen = () => { statusDiv.textContent = 'Connected'; statusDiv.className = 'text-xs font-medium p-1 rounded text-center mt-2 status-connected'; };
            state.paperTrade.priceSocket.onmessage = (event) => {
                const data = JSON.parse(event.data);
                if (data.p) {
                    state.paperTrade.currentPrice = parseFloat(data.p);
                    checkAllPositions(); 
                    updatePaperTradeUI();
                }
            };
            state.paperTrade.priceSocket.onclose = () => { statusDiv.textContent = 'Disconnected'; statusDiv.className = 'text-xs font-medium p-1 rounded text-center mt-2 status-disconnected'; };
        }

        function savePaperTradeState() {
            localStorage.setItem('openTradingPaperState', JSON.stringify({
                accountBalance: state.paperTrade.accountBalance, openPositions: state.paperTrade.openPositions,
                closedOrders: state.paperTrade.closedOrders, currentSymbol: state.paperTrade.currentSymbol,
            }));
        }

        function loadPaperTradeState() {
            const savedState = localStorage.getItem('openTradingPaperState');
            if (savedState) {
                const data = JSON.parse(savedState);
                state.paperTrade.accountBalance = data.accountBalance || 10000;
                state.paperTrade.openPositions = data.openPositions || [];
                state.paperTrade.closedOrders = data.closedOrders || [];
                state.paperTrade.currentSymbol = data.currentSymbol || "BTCUSDT";
            }
        }

        function placeOrder(type) {
            const amount = parseFloat(dom.paper.amountInput.value);
            if (isNaN(amount) || amount <= 0) { alert(getTranslatedText('paper_alert_invalid_amount')); return; }
            if (amount > state.paperTrade.accountBalance) { alert(getTranslatedText('paper_alert_insufficient_balance')); return; }
            if (state.paperTrade.currentPrice === 0) { alert(getTranslatedText('paper_alert_no_price')); return; }
            state.paperTrade.accountBalance -= amount;
            state.paperTrade.openPositions.push({
                id: Date.now(), symbol: state.paperTrade.currentSymbol, type: type, margin: amount, 
                leverage: parseFloat(dom.paper.leverageSelect.value), entryPrice: state.paperTrade.currentPrice,
            });
            savePaperTradeState(); updatePaperTradeUI();
        }

        function closePosition(positionId, reason = 'Manual') {
            const index = state.paperTrade.openPositions.findIndex(p => p.id === positionId);
            if (index === -1) return;
            const position = state.paperTrade.openPositions[index];
            const pnl = calculatePL(position, state.paperTrade.currentPrice);
            state.paperTrade.accountBalance += (position.margin + pnl);
            state.paperTrade.closedOrders.unshift({ ...position, exitPrice: state.paperTrade.currentPrice, pnl, reason });
            state.paperTrade.openPositions.splice(index, 1);
            savePaperTradeState(); updatePaperTradeUI();
        }

        function checkAllPositions() {
             [...state.paperTrade.openPositions].forEach(p => {
                const liqPrice = calculateLiquidationPrice(p);
                if ((p.type === 'buy' && state.paperTrade.currentPrice <= liqPrice) || (p.type === 'sell' && state.paperTrade.currentPrice >= liqPrice)) {
                    closePosition(p.id, 'Liquidation');
                }
            });
        }
        
        const calculatePL = (p, exitPrice) => ((p.type === 'buy' ? 1 : -1) * (exitPrice - p.entryPrice)) * (p.margin * p.leverage / p.entryPrice);
        const calculateLiquidationPrice = (p) => p.entryPrice * (1 + (p.type === 'buy' ? -1 : 1) / p.leverage);
        
        function updatePaperTradeUI() {
            dom.paper.balanceDisplay.textContent = `${state.paperTrade.accountBalance.toFixed(2)} USDT`;
            dom.paper.pricePanelTitle.innerHTML = `${state.paperTrade.currentSymbol} Price`;
            dom.paper.priceDisplay.textContent = state.paperTrade.currentPrice > 0 ? `${state.paperTrade.currentPrice.toFixed(2)}` : '...';
            
            dom.paper.openPositionsTable.innerHTML = state.paperTrade.openPositions.map(p => {
                const pnl = calculatePL(p, state.paperTrade.currentPrice);
                return `
                    <tr class="border-b border-custom">
                        <td class="px-4 py-3">${p.symbol}</td>
                        <td class="px-4 py-3 font-bold ${p.type === 'buy' ? 'buy-text' : 'sell-text'}">${p.type.toUpperCase()}</td>
                        <td class="px-4 py-3">${p.margin.toFixed(2)}</td>
                        <td class="px-4 py-3">${p.entryPrice.toFixed(2)}</td>
                        <td class="px-4 py-3 sell-text">${calculateLiquidationPrice(p).toFixed(2)}</td>
                        <td class="px-4 py-3 font-bold ${pnl >= 0 ? 'buy-text' : 'sell-text'}">${pnl.toFixed(2)}</td>
                        <td class="px-4 py-3"><button class="close-position-btn text-xs bg-tertiary text-primary px-2 py-1 rounded hover:opacity-80" data-id="${p.id}">${getTranslatedText('tbl_action_close')}</button></td>
                    </tr>`;
            }).join('');

            dom.paper.closedOrdersTable.innerHTML = state.paperTrade.closedOrders.slice(0, 50).map(o => `
                <tr class="border-b border-custom">
                    <td class="px-4 py-3">${o.symbol}</td>
                    <td class="px-4 py-3 font-bold ${o.type === 'buy' ? 'buy-text' : 'sell-text'}">${o.type.toUpperCase()}</td>
                    <td class="px-4 py-3">${o.exitPrice.toFixed(2)}</td>
                    <td class="px-4 py-3 font-bold ${o.pnl >= 0 ? 'buy-text' : 'sell-text'}">${o.pnl.toFixed(2)}</td>
                    <td class="px-4 py-3">${o.reason}</td>
                </tr>`).join('');
            
            document.querySelectorAll('.close-position-btn').forEach(btn => btn.onclick = () => closePosition(parseInt(btn.dataset.id)));
        }

        const setupEventListeners = () => {
            dom.navItems.forEach(item => item.addEventListener('click', (e) => { e.preventDefault(); switchSection(item.dataset.section); }));
            dom.langSwitcher.addEventListener('click', (e) => { e.stopPropagation(); dom.langDropdown.classList.toggle('hidden'); });
            document.addEventListener('click', (e) => { if (!dom.langSwitcher.contains(e.target)) dom.langDropdown.classList.add('hidden'); });
            dom.paper.symbolInput.addEventListener('change', () => setupForSymbol(dom.paper.symbolInput.value));
            dom.paper.buyButton.addEventListener('click', () => placeOrder('buy'));
            dom.paper.sellButton.addEventListener('click', () => placeOrder('sell'));
            dom.chartTabBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const tabId = btn.dataset.tab;
                    dom.chartTabBtns.forEach(b => b.classList.remove('accent-text', 'border-b-2', 'accent-border'));
                    btn.classList.add('accent-text', 'border-b-2', 'accent-border');
                    dom.chartsTabContents.forEach(c => c.classList.toggle('active', c.id === `${tabId}-tab-content`));
                });
            });
        };

        const initializeApp = () => {
            state.currentLang = ['en', 'bg'].includes(localStorage.getItem('language')) ? localStorage.getItem('language') : 'en';
            populateLanguageDropdown();
            setupEventListeners();
            loadPaperTradeState();
            setupForSymbol(state.paperTrade.currentSymbol);
            updateLanguage();
            document.querySelector('.nav-item[data-section="news"]').click();
            document.querySelector('.chart-tab-btn[data-tab="chart"]').click();
        }

        const startLoadingSimulation = () => {
            let progress = 0;
            const interval = setInterval(() => {
                progress += 1;
                dom.progressBar.style.width = `${progress}%`;
                dom.progressText.textContent = `${progress}%`;
                
                if (progress >= 100) {
                    clearInterval(interval);
                    initializeApp(); // Initialize the app logic
                    
                    setTimeout(() => {
                        dom.loadingScreen.classList.add('fade-out');
                        dom.mainAppContainer.classList.remove('hidden');
                        setTimeout(() => {
                           dom.loadingScreen.classList.add('hidden');
                        }, 500); // Wait for fade-out transition
                    }, 200); // Short delay for a smoother feel
                }
            }, 20); // Interval for progress update
        };

        document.addEventListener('DOMContentLoaded', startLoadingSimulation);
    </script>
</body>
</html>
